<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="http://robo.li/framework/">
        <link rel="shortcut icon" href="../img/favicon.png">
        
        <title>Robo as Framework - Robo</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">
        <link href="/css/robo.css" rel="stylesheet">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Robo</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link">Index</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Guides <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../getting-started/" class="dropdown-item">Getting Started</a>
</li>
                                    
<li>
    <a href="../collections/" class="dropdown-item">Collections</a>
</li>
                                    
<li>
    <a href="../extending/" class="dropdown-item">Extending</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">Robo as Framework</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Tasks <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../tasks/Base/" class="dropdown-item">Base Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Filesystem/" class="dropdown-item">FileSystem Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/File/" class="dropdown-item">File Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Composer/" class="dropdown-item">Composer Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Vcs/" class="dropdown-item">VCS Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Development/" class="dropdown-item">Development Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Assets/" class="dropdown-item">Assets Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Archive/" class="dropdown-item">Archive Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Remote/" class="dropdown-item">SSH, Rsync Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Testing/" class="dropdown-item">Testing Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Npm/" class="dropdown-item">NPM Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Bower/" class="dropdown-item">Bower Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Gulp/" class="dropdown-item">Gulp Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/Docker/" class="dropdown-item">Docker Tasks</a>
</li>
                                    
<li>
    <a href="../tasks/ApiGen/" class="dropdown-item">ApiGen Tasks</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../changelog/" class="nav-link">Releases</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../extending/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../tasks/Base/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/consolidation/Robo/edit/master/docs/framework.md" class="nav-link"><i class="fa fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#robo-as-a-framework" class="nav-link">Robo as a Framework</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#creating-a-standalone-phar-with-robo" class="nav-link">Creating a Standalone Phar with Robo</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-multiple-robofiles-in-a-standalone-application" class="nav-link">Using Multiple RoboFiles in a Standalone Application</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-your-own-dependency-injection-container-with-robo-advanced" class="nav-link">Using Your Own Dependency Injection Container with Robo (Advanced)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#using-a-custom-configuration-loader" class="nav-link">Using a Custom Configuration Loader</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="robo-as-a-framework">Robo as a Framework</h1>
<p>For a faster and better start to creating your own commandline application, please see the documentation in the <a href="https://github.com/g1a/starter">g1a/starter</a> project.</p>
<p>There are multiple ways to use and package Robo scripts; a few of the alternatives are presented below.</p>
<h2 id="creating-a-standalone-phar-with-robo">Creating a Standalone Phar with Robo</h2>
<p>It is possible to create a standalone phar that is implemented with Robo; doing this does not require the RoboFile to be located in the current working directory, or any particular location within your project. To achieve this, first set up your project as shown in the section <a href="../getting-started/#implementing-composer-scripts-with-robo">Implementing Composer Scripts with Robo</a>. Use of the "scripts" section is optional.</p>
<p>Next, add an "autoload" section to your composer.json to provide a namespace for your Robo commands:</p>
<pre><code class="language-json">{
    &quot;name&quot;: &quot;myorg/myproject&quot;,
    &quot;require&quot;: {
        &quot;consolidation/Robo&quot;: &quot;^2&quot;
    },
    &quot;autoload&quot;:{
        &quot;psr-4&quot;:{
            &quot;MyProject\\&quot;:&quot;src&quot;
        }
    }
}
</code></pre>
<p>Create a new file for your Robo commands, e.g. <code>class RoboFile</code> in <code>namespace MyProject\Commands;</code> in the file <code>src\Commands\RoboFile.php</code>.  Optionally, add more task libraries as described in the <a href="../extending/">extending</a> document.</p>
<p>Create a startup script similar to the one below, and add it to the root of your project, or some other location of your choosing:</p>
<pre><code class="language-php">#!/usr/bin/env php
&lt;?php

// If we're running from phar load the phar autoload file.
$pharPath = \Phar::running(true);
if ($pharPath) {
    $autoloaderPath = &quot;$pharPath/vendor/autoload.php&quot;;
} else {
    if (file_exists(__DIR__.'/vendor/autoload.php')) {
        $autoloaderPath = __DIR__.'/vendor/autoload.php';
    } elseif (file_exists(__DIR__.'/../../autoload.php')) {
        $autoloaderPath = __DIR__ . '/../../autoload.php';
    } else {
        die(&quot;Could not find autoloader. Run 'composer install'.&quot;);
    }
}
$classLoader = require $autoloaderPath;

// Customization variables
$appName = &quot;MyAppName&quot;;
$appVersion = trim(file_get_contents(__DIR__ . '/VERSION'));
$commandClasses = [ \MyProject\Commands\RoboFile::class ];
$selfUpdateRepository = 'myorg/myproject';
$configurationFilename = 'myconfig.yml';

// Define our Runner, and pass it the command classes we provide.
$runner = new \Robo\Runner($commandClasses);
$runner
  -&gt;setSelfUpdateRepository($selfUpdateRepository)
  -&gt;setConfigurationFilename($configurationFilename)
  -&gt;setClassLoader($classLoader);

// Execute the command and return the result.
$output = new \Symfony\Component\Console\Output\ConsoleOutput();
$statusCode = $runner-&gt;execute($argv, $appName, $appVersion, $output);
exit($statusCode);
</code></pre>
<p>When using Robo as a framework, the Robo file should be included in the autoloader, as Robo does not include a <code>RoboFile.php</code> file when used in this mode. Instead, specify the class or classes to load as a parameter to the Robo\Runner constructor.</p>
<p>Use <a href="https://github.com/box-project/box2">box-project/box2</a> or Robo's taskPackPhar to create a phar for your application. If your application's repository is hosted on GitHub, then passing the appropriate GitHub <code>org/project</code> to the <code>\Robo\Robo::run()</code> method, as shown above, will enable the <code>self:update</code> command to automatically update to the latest available version. Note that <code>self:update</code> only works with phar distributions.</p>
<h2 id="using-multiple-robofiles-in-a-standalone-application">Using Multiple RoboFiles in a Standalone Application</h2>
<p>It is possible to provide as many command classes as you wish to the Robo <code>Runner()</code> constructor. You might wish to separate your Robo command implementations into separate Robo files if you have a lot of commands, or if you wish to group similar commands together in the same source file. If you do this, you can simply add more class references to the <code>$commandClasses</code> variable shown above.</p>
<pre><code>$commandClasses = [ 
    \MyProject\Commands\BuildCommands::class, 
    \MyProject\Commands\DeployCommands::class 
];
</code></pre>
<p>If your application has a large number of command files, or if it supports command extensions, then you might wish to use the Command Discovery class to locate your files. The <code>CommandFileDiscovery</code> class will use the Symfony Finder class to search for all filenames matching the provided search pattern. It will return a list of class names using the provided base namespace.</p>
<pre><code class="language-php">$discovery = new \Consolidation\AnnotatedCommand\CommandFileDiscovery();
$discovery-&gt;setSearchPattern('*Command.php');
$commandClasses = $discovery-&gt;discover('php/MyProject/Commands', '\MyProject\Commands');
</code></pre>
<p>Pass the resulting <code>$commandClasses</code> to the <code>Runner()</code> constructor as shown above.  See the annotated-commands project for more information about the different options that the discovery command takes.</p>
<h2 id="using-your-own-dependency-injection-container-with-robo-advanced">Using Your Own Dependency Injection Container with Robo (Advanced)</h2>
<p>It is also possible to completely replace the Robo application with your own.  To do this, set up your project as described in the sections above, but replace the Robo runner with your own main event loop.</p>
<p>Add the following to your startup file:</p>
<pre><code class="language-php">&lt;?php
use League\Container\Container;
use Robo\Robo;

$input = new \Symfony\Component\Console\Input\ArgvInput($argv);
$output = new \Symfony\Component\Console\Output\ConsoleOutput();
$config = Robo::createConfiguration(['myconf.yml']);
$app = new \MyApplication($config, $input, $output);
$status_code = $app-&gt;run($input, $output);
exit($status_code);

</code></pre>
<p>Then, create your own custom application:</p>
<pre><code class="language-php">&lt;?php

use Robo\Common\ConfigAwareTrait;
use Robo\Config;
use Robo\Robo;
use Robo\Runner as RoboRunner;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;

class MyApplication {

  const APPLICATION_NAME = 'My Application';
  const REPOSITORY = 'org/project';

  use ConfigAwareTrait;

  private $runner;

  public function __construct(
    Config $config,
    InputInterface $input = NULL,
    OutputInterface $output = NULL
  ) {

    // Create applicaton.
    $this-&gt;setConfig($config);
    $application = new Application(self::APPLICATION_NAME, $config-&gt;get('version'));

    // Create and configure container.
    $container = Robo::createContainer($application, $config);
    $container-&gt;add(MyCustomService::class); // optional
    Robo::finalizeContainer($container);

    // Instantiate Robo Runner.
    $this-&gt;runner = new RoboRunner([
      My\Custom\Command::class
    ]);
    $this-&gt;runner-&gt;setContainer($container);
    $this-&gt;runner-&gt;setSelfUpdateRepository(self::REPOSITORY);
  }

  public function run(InputInterface $input, OutputInterface $output) {
    $status_code = $this-&gt;runner-&gt;run($input, $output);

    return $status_code;
  }

}
</code></pre>
<p>If you are using League\Container (recommended), then you may simply add and share your own classes to the same container.  If you are using some other DI container, then you should use <a href="https://github.com/container-interop/fig-standards/blob/master/proposed/container.md#14-additional-feature-delegate-lookup">delegate lookup</a> to combine them.</p>
<h2 id="using-a-custom-configuration-loader">Using a Custom Configuration Loader</h2>
<p>Robo provides a very simple configuration loader. If you wish to use more capable loader, you may opt to do so. Replace the call to <code>Robo::createConfiguration()</code> with code similar to the following:</p>
<pre><code>use Robo\Config\Config;
use Consolidation\Config\Loader\YamlConfigLoader;
use Consolidation\Config\Loader\ConfigProcessor;

$config = new Config();
$loader = new YamlConfigLoader();
$processor = new ConfigProcessor();
$processor-&gt;extend($loader-&gt;load('defaults.yml'));
$processor-&gt;extend($loader-&gt;load('myconf.yml'));
$config-&gt;import($processor-&gt;export());
</code></pre>
<p>You may also wish to subclass the provided <code>Config</code> and <code>ConfigProcessor</code> classes to customize their behavior.</p>
<p>The example above presumes that the configuration object starts off empty. If you need to repeat this process to extend the configuration in a later stage, you should call <code>$processor-&gt;add($config-&gt;export());</code> to ensure that the configuration processor is seeded with the previous configuration values.</p>
<p>Any configuraiton loader that produces a nested array may be used in place of the config loaders and config processor shown in the example above. For example, if you wish to find configuration files in a certain set of directories, allow .yml or .xml configuration files, and validate the schema of your configuration files (to alert users of any syntax errors or unrecognized configuration values), you might want to consider <a href="http://symfony.com/doc/current/components/config/definition.html">Symfony/Config</a>. Symfony/Config produces a clean array of configuration values; the result of <code>$processor-&gt;processConfiguration()</code> may be provided directly to Robo's <code>$config-&gt;import()</code> method.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
